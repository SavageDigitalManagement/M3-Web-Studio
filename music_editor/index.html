<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>M3 Web Studio — Browser Music Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%230b1116'/%3E%3Cpath d='M14 36c8-10 16-10 24 0 6 8 14 8 12-6' stroke='%2300e5ff' stroke-width='4' fill='none'/%3E%3Ccircle cx='20' cy='24' r='4' fill='%236bffb8'/%3E%3C/svg%3E">
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo">M3 WEB STUDIO</div>
        <div class="tag" data-i18n="app.tag">sleek browser music editor</div>
      </div>
      <div class="transport">
        <button id="playBtn" class="btn primary" data-i18n="btn.play">Play</button>
        <button id="pauseBtn" class="btn" data-i18n="btn.pause">Pause</button>
        <button id="stopBtn" class="btn" data-i18n="btn.stop">Stop</button>
        <div class="time" id="timeReadout">00:00.0</div>
        <div class="time" id="barBeatReadout">1.1.1</div>
      </div>
      <div class="tools">
        <label class="file">
          <input id="fileInput" type="file" accept="audio/*" multiple />
          <span data-i18n="btn.import">Import Audio</span>
        </label>
        <input id="ytUrl" type="text" class="btn hidden" placeholder="YouTube URL" />
        <button id="ripSelectedBtn" class="btn hidden">Rip → Selected</button>
        <button id="ripNewBtn" class="btn hidden">Rip → New Track</button>
        <select id="exportFormat" class="btn">
          <option value="wav" data-i18n="btn.exportWav">Export WAV</option>
          <option value="webm" data-i18n="btn.exportWebm">Export WebM (Opus)</option>
          <option value="ogg" data-i18n="btn.exportOgg">Export OGG (Opus)</option>
        </select>
        <button id="exportBtn" class="btn" data-i18n="btn.export">Export</button>
        <button id="addTrack" class="btn" data-i18n="btn.addTrack">Add Track</button>
        <button id="settingsBtn" class="btn" data-i18n="btn.settings">Settings</button>
      </div>
    </header>

    <section class="studio">
      <aside class="sidebar">
        <div class="panel">
        <div class="panel-title" data-i18n="panel.tracks">Tracks</div>
        <div id="mixerSidebar"></div>
      </div>
    </aside>
      <main class="timeline" id="timeline">
        <div class="ruler" id="ruler"></div>
        <div id="rangeSelector" class="range-selector hidden">
          <div class="range-handle left"></div>
          <div class="range-body"></div>
          <div class="range-handle right"></div>
        </div>
        <div class="trackArea" id="trackArea"></div>
        <div class="playhead" id="playhead"></div>
        <div class="ghosthead" id="ghosthead"></div>
      </main>
    </section>
  </div>

  <div class="fx-overlay" aria-hidden="true">
    <div class="fx-scanline"></div>
    <div class="fx-noise"></div>
    <canvas id="fxParticles"></canvas>
  </div>

  <div id="contextMenu" class="context hidden"></div>

  <div id="bottomDrawer" class="bottom-drawer">
    <button id="menuToggle" class="menu-toggle"><span data-i18n="menu.title">M3 Menu</span></button>
    <div class="bottom-tabs">
      <button id="tabAudio" class="tab active" data-i18n="tab.audio">Audio</button>
      <button id="tabTracks" class="tab" data-i18n="tab.tracks">Tracks</button>
      <button id="tabMixer" class="tab" data-i18n="tab.mixer">Mixer</button>
      <button id="tabProject" class="tab" data-i18n="tab.project">Project</button>
      <button id="tabActions" class="tab" data-i18n="tab.actions">Actions</button>
      <button id="tabEffects" class="tab" data-i18n="tab.effects">Effects</button>
    </div>
    <div class="bottom-panel" id="panelAudio">
    <div id="panelResize" class="panel-resize"></div>
    <div class="panel-title" data-i18n="panel.selectedClip">Selected Clip</div>
    <div class="audio-preview">
      <div>
        <div id="clipName" class="muted">No clip selected</div>
        <div class="mini-controls">
          <label class="toggle">
            <input id="miniFollowToggle" type="checkbox" checked />
            <span data-i18n="btn.miniFollow">Mini Follow</span>
          </label>
          <button id="audioPlay" class="btn primary" data-i18n="btn.play">Play</button>
          <button id="audioPause" class="btn" data-i18n="btn.pause">Pause</button>
          <button id="audioStop" class="btn" data-i18n="btn.stop">Stop</button>
          <button id="audioSplit" class="btn" data-i18n="btn.split">Split</button>
          <button id="audioDuplicate" class="btn" data-i18n="btn.duplicate">Duplicate</button>
          <button id="audioDelete" class="btn" data-i18n="btn.delete">Delete</button>
        </div>
      </div>
      <div id="previewWrap" class="preview-wrap">
        <div id="previewPlayhead" class="preview-playhead"></div>
        <canvas id="clipPreview" width="1200" height="120"></canvas>
      </div>
    </div>
  </div>
    <div class="bottom-panel hidden" id="panelMixer">
    <div class="panel-title" data-i18n="panel.eq">Track EQ + Filters</div>
    <div id="eqControls" class="eq-grid"></div>
  </div>
    <div class="bottom-panel hidden" id="panelTracks">
      <div class="panel-title" data-i18n="panel.tracks">Tracks</div>
      <div id="mixerPanel"></div>
    </div>
    <div class="bottom-panel hidden" id="panelProject">
    <div class="panel-title" data-i18n="panel.project">Project</div>
    <div class="project-info">
      <div><span data-i18n="project.tempo">Tempo</span><strong id="tempoValue">120</strong></div>
      <div><span data-i18n="project.key">Key</span><strong>—</strong></div>
      <div><span data-i18n="project.length">Length</span><strong id="projectLen">0.0s</strong></div>
    </div>
    <div class="project-actions">
      <div class="project-row">
        <button id="saveProjectFile" class="btn" data-i18n="project.saveFile">Save Project File</button>
        <button id="loadProjectFile" class="btn" data-i18n="project.loadFile">Load Project File</button>
        <input id="projectFileInput" type="file" accept=".m3proj,application/json" class="hidden" />
      </div>
      <div class="project-row">
        <label class="toggle">
          <input id="includeAudioInFile" type="checkbox" checked />
          <span data-i18n="project.includeAudio">Include audio in file</span>
        </label>
      </div>
      <div class="project-row">
        <button id="saveProjectLocal" class="btn" data-i18n="project.saveLocal">Save to Browser</button>
        <button id="loadProjectLocal" class="btn" data-i18n="project.loadLocal">Load from Browser</button>
        <button id="clearProjectLocal" class="btn" data-i18n="project.clearLocal">Clear Local</button>
      </div>
      <div id="projectStatus" class="hint muted" data-i18n="project.status">Project saves are local unless you export a file.</div>
    </div>
  </div>
    <div class="bottom-panel hidden" id="panelActions">
    <div class="panel-title" data-i18n="panel.actions">Actions</div>
    <button id="splitBtn" class="btn" data-i18n="btn.splitPlayhead">Split at Playhead</button>
    <button id="duplicateBtn" class="btn" data-i18n="btn.duplicateClip">Duplicate Clip</button>
    <button id="deleteBtn" class="btn" data-i18n="btn.deleteClip">Delete Clip</button>
    <div class="hint" data-i18n="actions.hint">Select a clip to edit. Drag clips on the timeline.</div>
  </div>
    <div class="bottom-panel hidden" id="panelEffects">
    <div class="panel-title" data-i18n="panel.effects">Effects</div>
    <div class="effects-actions">
      <button id="fxFadeIn" class="btn" data-i18n="fx.fadeIn">Fade In Selection…</button>
      <button id="fxFadeOut" class="btn" data-i18n="fx.fadeOut">Fade Out Selection…</button>
      <button id="fxCrossfade" class="btn" data-i18n="fx.crossfade">Crossfade Selection…</button>
    </div>
    <div class="hint muted" data-i18n="fx.tip">Tip: Alt + drag on the timeline to create a selection range.</div>
    <div class="effects-grid">
      <div class="effects-section">
        <div class="panel-title" data-i18n="fx.clipTitle">Clip FX (Selected Clip)</div>
        <div class="effect-row">
          <label data-i18n="fx.timeStretch">Time Stretch</label>
          <input id="clipRate" type="range" min="0.5" max="2" step="0.01" value="1" />
          <span id="clipRateVal" class="muted">1.00x</span>
        </div>
        <div class="effect-row">
          <label data-i18n="fx.pitch">Pitch</label>
          <input id="clipPitch" type="range" min="-12" max="12" step="1" value="0" />
          <span id="clipPitchVal" class="muted">0 st</span>
        </div>
        <div class="effect-row">
          <button id="clipFxApply" class="btn" data-i18n="fx.applyStretch">Apply Stretch</button>
          <button id="clipFxReset" class="btn" data-i18n="fx.resetClip">Reset Clip FX</button>
        </div>
        <div class="hint muted" data-i18n="fx.clipHint">Time Stretch is granular and keeps pitch. Pitch shifts by resampling.</div>
      </div>
      <div class="effects-section">
        <div class="panel-title" data-i18n="fx.trackTitle">Track FX (Selected Track)</div>
        <div class="effect-row">
          <label><input id="fxDelayOn" type="checkbox" /> <span data-i18n="fx.delay">Delay</span></label>
          <input id="fxDelayTime" type="range" min="0" max="0.8" step="0.01" value="0.2" />
          <input id="fxDelayFeedback" type="range" min="0" max="0.9" step="0.01" value="0.3" />
          <input id="fxDelayMix" type="range" min="0" max="1" step="0.01" value="0.25" />
        </div>
        <div class="effect-row">
          <label><input id="fxReverbOn" type="checkbox" /> <span data-i18n="fx.reverb">Reverb</span></label>
          <input id="fxReverbMix" type="range" min="0" max="1" step="0.01" value="0.2" />
        </div>
        <div class="effect-row">
          <label><input id="fxSatOn" type="checkbox" /> <span data-i18n="fx.saturation">Saturation</span></label>
          <input id="fxSatDrive" type="range" min="0" max="1" step="0.01" value="0.2" />
        </div>
        <div class="effect-row">
          <label><input id="fxCompOn" type="checkbox" /> <span data-i18n="fx.compressor">Compressor</span></label>
          <input id="fxCompThreshold" type="range" min="-60" max="0" step="1" value="-18" />
          <input id="fxCompRatio" type="range" min="1" max="20" step="0.5" value="4" />
        </div>
      </div>
    </div>
  </div>

  </div>

    <div id="settingsHud" class="hud hidden">
      <div class="hud-header">
        <div class="hud-title" data-i18n="hud.title">M3 Settings</div>
        <button id="closeHud" class="btn">Close</button>
      </div>
      <div class="hud-grid">
      <label><span data-i18n="hud.bpm">BPM</span>
        <input id="bpmInput" type="number" min="40" max="220" value="120" />
      </label>
      <label><span data-i18n="hud.snap">Snap to Beat</span>
        <input id="snapToggle" type="checkbox" checked />
      </label>
      <label><span data-i18n="hud.follow">Auto-Scroll</span>
        <input id="followToggle" type="checkbox" checked />
      </label>
      <label><span data-i18n="hud.grid">Beat Grid</span>
        <select id="gridSelect">
          <option value="1">1/1</option>
          <option value="2">1/2</option>
          <option value="4" selected>1/4</option>
          <option value="8">1/8</option>
          <option value="16">1/16</option>
        </select>
      </label>
      <input id="analysisUrl" type="hidden" />
      <label><span data-i18n="hud.metro">Metronome</span>
        <input id="metroToggle" type="checkbox" />
      </label>
      <label><span data-i18n="hud.fxIntensity">FX Intensity</span>
        <input id="fxIntensity" type="range" min="0" max="100" value="35" />
      </label>
      <label><span data-i18n="hud.fxNoise">Screen Noise</span>
        <input id="fxNoiseToggle" type="checkbox" checked />
      </label>
      <label><span data-i18n="hud.fxGlow">Frame Glow</span>
        <input id="fxGlowToggle" type="checkbox" checked />
      </label>
      <label><span data-i18n="hud.zoom">Zoom</span>
        <input id="zoomHud" type="range" min="5" max="100000" value="120" />
      </label>
      <label><span data-i18n="hud.lang">Language</span>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="zh">简体中文</option>
          <option value="id">Bahasa Indonesia</option>
          <option value="ms">Bahasa Malaysia</option>
          <option value="ko">한국어</option>
        </select>
      </label>
      <input id="zoom" type="range" min="5" max="100000" value="120" class="hidden" />
      </div>
      <div class="hud-hint" data-i18n="hud.hint">
        Hotkeys: Space Play/Pause · S Split · D Duplicate · Del Delete · +/- Zoom
      </div>
      <div class="hud-guide">
        <details>
          <summary data-i18n="guide.desktop.title">Desktop Guide</summary>
          <div class="guide-text" id="desktopGuideText"></div>
        </details>
        <details>
          <summary data-i18n="guide.mobile.title">Mobile Guide</summary>
          <div class="guide-text" id="mobileGuideText"></div>
        </details>
      </div>
    </div>

      <div id="analysisOverlay" class="overlay hidden">
    <div class="overlay-card">
      <div class="overlay-title" data-i18n="overlay.analyzeTitle">Analyzing BPM + Key…</div>
      <div class="overlay-sub" data-i18n="overlay.analyzeSub">This can take a few seconds on longer files.</div>
      <div class="progress">
        <div id="analysisProgress" class="progress-bar"></div>
      </div>
    </div>
  </div>

  <div id="effectOverlay" class="overlay hidden">
    <div class="overlay-card effect-card">
      <div class="overlay-title" id="effectTitle" data-i18n="overlay.effectTitle">Apply Effect</div>
      <div class="overlay-sub" data-i18n="overlay.effectSub">Applies to the current selection range.</div>
      <div class="hud-grid effect-grid">
        <label><span data-i18n="overlay.effect">Effect</span>
          <select id="effectType">
            <option value="fadeIn">Fade In</option>
            <option value="fadeOut">Fade Out</option>
            <option value="crossfade">Crossfade</option>
          </select>
        </label>
        <label><span data-i18n="overlay.duration">Duration (sec)</span>
          <input id="effectDuration" type="number" min="0.05" step="0.05" value="0.5" />
        </label>
        <label><span data-i18n="overlay.curve">Curve</span>
          <input id="effectCurve" type="range" min="0" max="1" step="0.01" value="0.5" />
        </label>
      </div>
      <div class="effect-actions">
        <button id="effectApply" class="btn primary" data-i18n="btn.apply">Apply</button>
        <button id="effectCancel" class="btn" data-i18n="btn.cancel">Cancel</button>
      </div>
    </div>
  </div>

  <div id="relinkOverlay" class="overlay hidden">
    <div class="overlay-card effect-card">
      <div class="overlay-title" data-i18n="overlay.relinkTitle">Relink Audio Files</div>
      <div class="overlay-sub" data-i18n="overlay.relinkSub">Some clips are missing audio. Select the original files to relink.</div>
      <div id="relinkList" class="relink-list"></div>
      <input id="relinkInput" type="file" multiple accept="audio/*" />
      <div class="effect-actions">
        <button id="relinkApply" class="btn primary" data-i18n="btn.relink">Relink</button>
        <button id="relinkSkip" class="btn" data-i18n="btn.skipMissing">Skip Missing</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
